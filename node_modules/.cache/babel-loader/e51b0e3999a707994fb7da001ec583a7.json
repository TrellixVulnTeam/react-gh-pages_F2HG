{"ast":null,"code":"import _toConsumableArray from\"/home/arcanjolevi/Documents/www/react-gh-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/arcanjolevi/Documents/www/react-gh-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect}from\"react\";import{useContext}from\"react\";import{useState}from\"react\";import{createContext}from\"react\";import{io}from\"socket.io-client\";import{baseUrlServer}from\"../services/api\";import{AuthContext}from\"./Auth\";import{jsx as _jsx}from\"react/jsx-runtime\";export var MessageContext=/*#__PURE__*/createContext({});export function MessageContextProvider(props){var _useContext=useContext(AuthContext),user=_useContext.user;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),buffer=_useState4[0],setBuffer=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),usersOnline=_useState6[0],setUsersOnline=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),currentChatUser=_useState8[0],setCurrentChatUser=_useState8[1];var _useState9=useState(io()),_useState10=_slicedToArray(_useState9,2),socket=_useState10[0],setSocket=_useState10[1];useEffect(function(){console.log(messages);},[messages]);useEffect(function(){if(typeof buffer!==\"undefined\"){setMessages([].concat(_toConsumableArray(messages),[buffer]));}},[buffer]);useEffect(function(){var newSocket=io(baseUrlServer,{query:{id:user.uid,type:\"supervisor\"}});newSocket.on(\"disconnect\",function(){console.log(\"client desconectado\");});newSocket.on(\"message\",function(data){console.log(data);receiveMsg(data.message,data.driverId,data.supervisorId,data.senderId);});setSocket(newSocket);return function(){newSocket.close();};},[]);function getUsersOnline(){socket.emit(\"online\",{},function(data){console.log(data);setUsersOnline(data);});}function changeCurrentChatUser(chatUser){setMessages([]);setCurrentChatUser(chatUser);socket.emit(\"chat\",{id1:user.uid,id2:chatUser.authId});}function receiveMsg(message,driverId,supervisorId,senderId){console.log(message);var newMsg={driverId:driverId,message:message,senderId:senderId,supervisorId:supervisorId,timestamp:new Date().getTime()};setBuffer(newMsg);}function sendMsg(msg){socket.emit(\"message\",{driverId:(currentChatUser===null||currentChatUser===void 0?void 0:currentChatUser.authId)||\"\",message:msg,senderId:user.uid,supervisorId:user.uid});var newMsg={driverId:(currentChatUser===null||currentChatUser===void 0?void 0:currentChatUser.authId)||\"\",message:msg,senderId:user.uid,supervisorId:user.uid,timestamp:new Date().getTime()};setBuffer(newMsg);}return/*#__PURE__*/_jsx(MessageContext.Provider,{value:{currentChatUser:currentChatUser,usersOnline:usersOnline,getUsersOnline:getUsersOnline,changeCurrentChatUser:changeCurrentChatUser,messages:messages,sendMsg:sendMsg},children:props.children});}","map":{"version":3,"sources":["/home/arcanjolevi/Documents/www/react-gh-pages/src/contexts/Messages.tsx"],"names":["useEffect","useContext","useState","createContext","io","baseUrlServer","AuthContext","MessageContext","MessageContextProvider","props","user","messages","setMessages","buffer","setBuffer","usersOnline","setUsersOnline","currentChatUser","setCurrentChatUser","socket","setSocket","console","log","newSocket","query","id","uid","type","on","data","receiveMsg","message","driverId","supervisorId","senderId","close","getUsersOnline","emit","changeCurrentChatUser","chatUser","id1","id2","authId","newMsg","timestamp","Date","getTime","sendMsg","msg","children"],"mappings":"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","sourcesContent":["import { ReactNode } from \"react\";\nimport { useEffect } from \"react\";\nimport { useContext } from \"react\";\nimport { useState } from \"react\";\nimport { createContext } from \"react\";\nimport { io } from \"socket.io-client\";\nimport { baseUrlServer } from \"../services/api\";\nimport { AuthContext } from \"./Auth\";\n\ntype ComponentProps = {\n  children: ReactNode;\n};\n\nexport type ChatUserProps = {\n  authId: string;\n  name: string;\n  picture: string;\n  type: string;\n};\n\nexport type MessageProps = {\n  supervisorId: string;\n  driverId: string;\n  message: string;\n  senderId: string;\n  timestamp?: number;\n};\n\nexport type MessageObject = {\n  getUsersOnline: () => void;\n  usersOnline: ChatUserProps[];\n  currentChatUser?: ChatUserProps;\n  changeCurrentChatUser: (value: ChatUserProps) => void;\n  messages: MessageProps[];\n  sendMsg: (value: string) => void;\n};\n\nexport const MessageContext = createContext({} as MessageObject);\n\nexport function MessageContextProvider(props: ComponentProps) {\n  const { user } = useContext(AuthContext);\n\n  const [messages, setMessages] = useState<MessageProps[]>([]);\n  const [buffer, setBuffer] = useState<MessageProps>();\n\n  const [usersOnline, setUsersOnline] = useState<ChatUserProps[]>([]);\n  const [currentChatUser, setCurrentChatUser] = useState<ChatUserProps>();\n\n  const [socket, setSocket] = useState(io());\n\n  useEffect(() => {\n    console.log(messages);\n  }, [messages]);\n\n  useEffect(() => {\n    if (typeof buffer !== \"undefined\") {\n      setMessages([...messages, buffer]);\n    }\n  }, [buffer]);\n\n  useEffect(() => {\n    const newSocket = io(baseUrlServer, {\n      query: {\n        id: user.uid,\n        type: \"supervisor\",\n      },\n    });\n\n    newSocket.on(\"disconnect\", () => {\n      console.log(\"client desconectado\");\n    });\n\n    newSocket.on(\"message\", (data) => {\n      console.log(data);\n      receiveMsg(data.message, data.driverId, data.supervisorId, data.senderId);\n    });\n\n    setSocket(newSocket);\n\n    return () => {\n      newSocket.close();\n    };\n  }, []);\n\n  function getUsersOnline() {\n    socket.emit(\"online\", {}, (data: any) => {\n      console.log(data);\n\n      setUsersOnline(data);\n    });\n  }\n\n  function changeCurrentChatUser(chatUser: ChatUserProps) {\n    setMessages([]);\n    setCurrentChatUser(chatUser);\n\n    socket.emit(\"chat\", {\n      id1: user.uid,\n      id2: chatUser.authId,\n    });\n  }\n\n  function receiveMsg(\n    message: string,\n    driverId: string,\n    supervisorId: string,\n    senderId: string\n  ) {\n    console.log(message);\n    const newMsg: MessageProps = {\n      driverId: driverId,\n      message: message,\n      senderId: senderId,\n      supervisorId: supervisorId,\n      timestamp: new Date().getTime(),\n    };\n\n    setBuffer(newMsg);\n  }\n\n  function sendMsg(msg: string) {\n    socket.emit(\"message\", {\n      driverId: currentChatUser?.authId || \"\",\n      message: msg,\n      senderId: user.uid,\n      supervisorId: user.uid,\n    });\n\n    const newMsg: MessageProps = {\n      driverId: currentChatUser?.authId || \"\",\n      message: msg,\n      senderId: user.uid,\n      supervisorId: user.uid,\n      timestamp: new Date().getTime(),\n    };\n    setBuffer(newMsg);\n  }\n\n  return (\n    <MessageContext.Provider\n      value={{\n        currentChatUser,\n        usersOnline,\n        getUsersOnline,\n        changeCurrentChatUser,\n        messages,\n        sendMsg,\n      }}\n    >\n      {props.children}\n    </MessageContext.Provider>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}