{"ast":null,"code":"import _regeneratorRuntime from\"/home/arcanjolevi/Documents/www/react-gh-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/arcanjolevi/Documents/www/react-gh-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/arcanjolevi/Documents/www/react-gh-pages/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect}from\"react\";import{useState}from\"react\";import{createContext}from\"react\";import{firebase,auth}from\"../services/firebase\";import{useHistory}from\"react-router-dom\";import api from\"../services/api\";import toast,{Toaster}from\"react-hot-toast\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var AuthContext=/*#__PURE__*/createContext({});export function AuthContextProvider(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isAuthenticated=_useState2[0],setIsAuthenticated=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var history=useHistory();useEffect(function(){var unsubscribe=auth.onAuthStateChanged(function(_user){if(_user){setIsAuthenticated(true);setUser(_user);}});return function(){unsubscribe();};});function signInWithGoogle(){var provider=new firebase.auth.GoogleAuthProvider();firebase.auth().signInWithPopup(provider).then(function(result){/** @type {firebase.auth.OAuthCredential} */var user=result.user;firebase.auth().signOut();api.post(\"supervisor\",{supervisorId:user===null||user===void 0?void 0:user.uid,supervisorName:user===null||user===void 0?void 0:user.displayName,supervisorPicture:user===null||user===void 0?void 0:user.photoURL}).then(function(r){toast.success(\"Login realizado com sucesso\");setIsAuthenticated(true);history.push(\"/\");}).catch(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(err){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:toast.error(\"Erro no login, tente novamente\");//signOut();\nhistory.push(\"/\");case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());}).catch(function(error){console.log(error);});}function signOut(){return _signOut.apply(this,arguments);}function _signOut(){_signOut=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return firebase.auth().signOut();case 2:setIsAuthenticated(false);toast.success(\"Logout realizado\");history.push(\"/\");case 5:case\"end\":return _context2.stop();}}},_callee2);}));return _signOut.apply(this,arguments);}return/*#__PURE__*/_jsxs(AuthContext.Provider,{value:{user:user,isAuthenticated:isAuthenticated,signInWithGoogle:signInWithGoogle,signOut:signOut},children:[/*#__PURE__*/_jsx(Toaster,{}),props.children]});}","map":{"version":3,"sources":["/home/arcanjolevi/Documents/www/react-gh-pages/src/contexts/Auth.tsx"],"names":["useEffect","useState","createContext","firebase","auth","useHistory","api","toast","Toaster","AuthContext","AuthContextProvider","props","isAuthenticated","setIsAuthenticated","user","setUser","history","unsubscribe","onAuthStateChanged","_user","signInWithGoogle","provider","GoogleAuthProvider","signInWithPopup","then","result","signOut","post","supervisorId","uid","supervisorName","displayName","supervisorPicture","photoURL","r","success","push","catch","err","error","console","log","children"],"mappings":"4eAAA,OAASA,SAAT,KAA0B,OAA1B,CAEA,OAASC,QAAT,KAAyB,OAAzB,CACA,OAASC,aAAT,KAA8B,OAA9B,CACA,OAASC,QAAT,CAAmBC,IAAnB,KAA+B,sBAA/B,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,MAAOC,CAAAA,GAAP,KAAgB,iBAAhB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,OAAhB,KAA+B,iBAA/B,C,wFAaA,MAAO,IAAMC,CAAAA,WAAW,cAAGP,aAAa,CAAC,EAAD,CAAjC,CAEP,MAAO,SAASQ,CAAAA,mBAAT,CAA6BC,KAA7B,CAAoD,CACzD,cAA8CV,QAAQ,CAAC,KAAD,CAAtD,wCAAOW,eAAP,eAAwBC,kBAAxB,eACA,eAAwBZ,QAAQ,CAAgB,EAAhB,CAAhC,yCAAOa,IAAP,eAAaC,OAAb,eACA,GAAMC,CAAAA,OAAO,CAAGX,UAAU,EAA1B,CAEAL,SAAS,CAAC,UAAM,CACd,GAAMiB,CAAAA,WAAW,CAAGb,IAAI,CAACc,kBAAL,CAAwB,SAACC,KAAD,CAAW,CACrD,GAAIA,KAAJ,CAAW,CACTN,kBAAkB,CAAC,IAAD,CAAlB,CACAE,OAAO,CAACI,KAAD,CAAP,CACD,CACF,CALmB,CAApB,CAOA,MAAO,WAAM,CACXF,WAAW,GACZ,CAFD,CAGD,CAXQ,CAAT,CAaA,QAASG,CAAAA,gBAAT,EAA4B,CAC1B,GAAIC,CAAAA,QAAQ,CAAG,GAAIlB,CAAAA,QAAQ,CAACC,IAAT,CAAckB,kBAAlB,EAAf,CACAnB,QAAQ,CACLC,IADH,GAEGmB,eAFH,CAEmBF,QAFnB,EAGGG,IAHH,CAGQ,SAACC,MAAD,CAAY,CAChB,4CAEA,GAAIX,CAAAA,IAAI,CAAGW,MAAM,CAACX,IAAlB,CACAX,QAAQ,CAACC,IAAT,GAAgBsB,OAAhB,GACApB,GAAG,CACAqB,IADH,CACQ,YADR,CACsB,CAClBC,YAAY,CAAEd,IAAF,SAAEA,IAAF,iBAAEA,IAAI,CAAEe,GADF,CAElBC,cAAc,CAAEhB,IAAF,SAAEA,IAAF,iBAAEA,IAAI,CAAEiB,WAFJ,CAGlBC,iBAAiB,CAAElB,IAAF,SAAEA,IAAF,iBAAEA,IAAI,CAAEmB,QAHP,CADtB,EAMGT,IANH,CAMQ,SAACU,CAAD,CAAO,CACX3B,KAAK,CAAC4B,OAAN,CAAc,6BAAd,EACAtB,kBAAkB,CAAC,IAAD,CAAlB,CACAG,OAAO,CAACoB,IAAR,CAAa,GAAb,EACD,CAVH,EAWGC,KAXH,0FAWS,iBAAOC,GAAP,kHACL/B,KAAK,CAACgC,KAAN,CAAY,gCAAZ,EACA;AACAvB,OAAO,CAACoB,IAAR,CAAa,GAAb,EAHK,sDAXT,gEAgBD,CAxBH,EAyBGC,KAzBH,CAyBS,SAACE,KAAD,CAAW,CAChBC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACD,CA3BH,EA4BD,CAhDwD,QAkD1Cb,CAAAA,OAlD0C,+HAkDzD,+JACQvB,CAAAA,QAAQ,CAACC,IAAT,GAAgBsB,OAAhB,EADR,QAEEb,kBAAkB,CAAC,KAAD,CAAlB,CACAN,KAAK,CAAC4B,OAAN,CAAc,kBAAd,EACAnB,OAAO,CAACoB,IAAR,CAAa,GAAb,EAJF,wDAlDyD,0CAyDzD,mBACE,MAAC,WAAD,CAAa,QAAb,EACE,KAAK,CAAE,CAAEtB,IAAI,CAAJA,IAAF,CAAQF,eAAe,CAAfA,eAAR,CAAyBQ,gBAAgB,CAAhBA,gBAAzB,CAA2CM,OAAO,CAAPA,OAA3C,CADT,wBAGE,KAAC,OAAD,IAHF,CAIGf,KAAK,CAAC+B,QAJT,GADF,CAQD","sourcesContent":["import { useEffect } from \"react\";\nimport { ReactNode } from \"react\";\nimport { useState } from \"react\";\nimport { createContext } from \"react\";\nimport { firebase, auth } from \"../services/firebase\";\nimport { useHistory } from \"react-router-dom\";\nimport api from \"../services/api\";\nimport toast, { Toaster } from \"react-hot-toast\";\n\ntype ComponentProps = {\n  children: ReactNode;\n};\n\ntype AuthObject = {\n  isAuthenticated: boolean;\n  signInWithGoogle: () => void;\n  signOut: () => void;\n  user: firebase.User;\n};\n\nexport const AuthContext = createContext({} as AuthObject);\n\nexport function AuthContextProvider(props: ComponentProps) {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [user, setUser] = useState<firebase.User>({} as firebase.User);\n  const history = useHistory();\n\n  useEffect(() => {\n    const unsubscribe = auth.onAuthStateChanged((_user) => {\n      if (_user) {\n        setIsAuthenticated(true);\n        setUser(_user);\n      }\n    });\n\n    return () => {\n      unsubscribe();\n    };\n  });\n\n  function signInWithGoogle() {\n    var provider = new firebase.auth.GoogleAuthProvider();\n    firebase\n      .auth()\n      .signInWithPopup(provider)\n      .then((result) => {\n        /** @type {firebase.auth.OAuthCredential} */\n\n        var user = result.user;\n        firebase.auth().signOut();\n        api\n          .post(\"supervisor\", {\n            supervisorId: user?.uid,\n            supervisorName: user?.displayName,\n            supervisorPicture: user?.photoURL,\n          })\n          .then((r) => {\n            toast.success(\"Login realizado com sucesso\");\n            setIsAuthenticated(true);\n            history.push(\"/\");\n          })\n          .catch(async (err) => {\n            toast.error(\"Erro no login, tente novamente\");\n            //signOut();\n            history.push(\"/\");\n          });\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  }\n\n  async function signOut() {\n    await firebase.auth().signOut();\n    setIsAuthenticated(false);\n    toast.success(\"Logout realizado\");\n    history.push(\"/\");\n  }\n\n  return (\n    <AuthContext.Provider\n      value={{ user, isAuthenticated, signInWithGoogle, signOut }}\n    >\n      <Toaster />\n      {props.children}\n    </AuthContext.Provider>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}